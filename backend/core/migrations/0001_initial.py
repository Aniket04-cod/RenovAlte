# Generated by Django 5.2.8 on 2026-01-10 15:50

import django.db.models.deletion
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='ContractingPlanning',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('description', models.TextField(help_text='Description of specific contracting needs', verbose_name='Description')),
                ('ai_summary', models.TextField(blank=True, help_text='AI-generated summary of the project', null=True, verbose_name='AI Generated Summary')),
                ('ai_questions', models.JSONField(blank=True, help_text='Questions generated by AI to clarify requirements', null=True, verbose_name='AI Generated Questions')),
                ('user_answers', models.JSONField(blank=True, help_text="User's answers to AI-generated questions", null=True, verbose_name='User Answers')),
                ('selected_contractors', models.JSONField(blank=True, help_text='Array of contractor IDs selected for invitation', null=True, verbose_name='Selected Contractors')),
                ('current_step', models.IntegerField(default=1, help_text='Current step in the contracting workflow (1-4)', verbose_name='Current Step')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
            ],
            options={
                'verbose_name': 'Contracting Planning',
                'verbose_name_plural': 'Contracting Plannings',
            },
        ),
        migrations.CreateModel(
            name='Contractor',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200, verbose_name='Contractor Name')),
                ('address', models.CharField(blank=True, max_length=300, verbose_name='Address')),
                ('city', models.CharField(blank=True, max_length=100, verbose_name='City')),
                ('postal_code', models.CharField(blank=True, max_length=20, verbose_name='Postal Code')),
                ('state', models.CharField(blank=True, max_length=100, verbose_name='State')),
                ('phone', models.CharField(blank=True, max_length=20, verbose_name='Phone')),
                ('website', models.URLField(blank=True, verbose_name='Website')),
                ('email', models.EmailField(blank=True, max_length=254, verbose_name='Email')),
                ('price_range', models.CharField(blank=True, max_length=50, verbose_name='Price Range')),
                ('service_area', models.CharField(blank=True, max_length=200, verbose_name='Service Area')),
                ('business_size', models.CharField(blank=True, max_length=50, verbose_name='Business Size')),
                ('years_in_business', models.IntegerField(blank=True, null=True, verbose_name='Years in Business')),
                ('services', models.TextField(blank=True, verbose_name='Services')),
                ('description', models.TextField(blank=True, verbose_name='Description')),
                ('specializations', models.TextField(blank=True, verbose_name='Specializations')),
                ('rating', models.DecimalField(blank=True, decimal_places=2, help_text='Rating out of 5.0', max_digits=3, null=True, verbose_name='Rating')),
                ('reviews_count', models.IntegerField(default=0, verbose_name='Reviews Count')),
                ('certifications', models.TextField(blank=True, verbose_name='Certifications')),
                ('kfw_eligible', models.BooleanField(default=False, verbose_name='KfW Eligible')),
                ('source', models.CharField(blank=True, max_length=100, verbose_name='Source')),
                ('additional_info', models.TextField(blank=True, verbose_name='Additional Info')),
                ('project_types', models.CharField(blank=True, help_text="Comma-separated list of project types (e.g., 'kitchen,bathroom,plumbing')", max_length=500, verbose_name='Project Types')),
            ],
            options={
                'verbose_name': 'Contractor',
                'verbose_name_plural': 'Contractors',
                'ordering': ['-rating', 'name'],
            },
        ),
        migrations.CreateModel(
            name='ContractingPlanningFile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('file', models.FileField(help_text='Uploaded document or photo', upload_to='contracting_planning/%Y/%m/%d/')),
                ('filename', models.CharField(max_length=255)),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('contracting_planning', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='files', to='core.contractingplanning')),
            ],
            options={
                'verbose_name': 'Contracting Planning File',
                'verbose_name_plural': 'Contracting Planning Files',
            },
        ),
        migrations.CreateModel(
            name='ContractorOffer',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('contractor_id', models.IntegerField(blank=True, help_text='ID of the contractor who made this offer', null=True, verbose_name='Contractor ID')),
                ('gmail_message_id', models.CharField(blank=True, help_text='Link to the email containing this offer', max_length=255, null=True, unique=True, verbose_name='Gmail Message ID')),
                ('total_price', models.DecimalField(blank=True, decimal_places=2, help_text='Total offer price', max_digits=12, null=True, verbose_name='Total Price')),
                ('currency', models.CharField(blank=True, default='EUR', help_text='Currency code (ISO 4217)', max_length=3, null=True, verbose_name='Currency')),
                ('timeline_start', models.DateField(blank=True, help_text='Proposed project start date', null=True, verbose_name='Timeline Start')),
                ('timeline_end', models.DateField(blank=True, help_text='Proposed project end date', null=True, verbose_name='Timeline End')),
                ('timeline_duration_days', models.IntegerField(blank=True, help_text='Project duration in days', null=True, verbose_name='Timeline Duration (Days)')),
                ('scope_of_work', models.TextField(blank=True, help_text='Description of work to be performed', null=True, verbose_name='Scope of Work')),
                ('materials_included', models.JSONField(blank=True, default=list, help_text='List of materials included in the offer', verbose_name='Materials Included')),
                ('labor_breakdown', models.JSONField(blank=True, default=dict, help_text='Cost breakdown by labor type', verbose_name='Labor Breakdown')),
                ('payment_terms', models.TextField(blank=True, help_text='Payment terms and conditions', null=True, verbose_name='Payment Terms')),
                ('payment_schedule', models.JSONField(blank=True, default=list, help_text='Payment milestones and amounts', verbose_name='Payment Schedule')),
                ('warranty_period', models.CharField(blank=True, help_text="Warranty period (e.g., '2 years')", max_length=100, null=True, verbose_name='Warranty Period')),
                ('warranty_details', models.TextField(blank=True, help_text='Detailed warranty information', null=True, verbose_name='Warranty Details')),
                ('insurance_details', models.TextField(blank=True, help_text='Insurance coverage information', null=True, verbose_name='Insurance Details')),
                ('special_conditions', models.TextField(blank=True, help_text='Any special conditions or notes', null=True, verbose_name='Special Conditions')),
                ('misc_details', models.JSONField(blank=True, default=dict, help_text='Additional information not captured in other fields (e.g., project manager, certifications, references)', verbose_name='Miscellaneous Details')),
                ('offer_date', models.DateField(blank=True, help_text='Date the offer was made', null=True, verbose_name='Offer Date')),
                ('valid_until', models.DateField(blank=True, help_text='Date until which the offer is valid', null=True, verbose_name='Valid Until')),
                ('extracted_data', models.JSONField(blank=True, default=dict, help_text='Full extracted JSON for flexibility', verbose_name='Extracted Data')),
                ('pdf_attachment_id', models.CharField(blank=True, help_text='Gmail attachment ID if offer was in PDF', max_length=255, null=True, verbose_name='PDF Attachment ID')),
                ('email_received_at', models.DateTimeField(blank=True, help_text='Timestamp when the offer email was received in Gmail', null=True, verbose_name='Email Received At')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('contracting_planning', models.ForeignKey(help_text='The contracting planning this offer is for', on_delete=django.db.models.deletion.CASCADE, related_name='offers', to='core.contractingplanning')),
            ],
            options={
                'verbose_name': 'Contractor Offer',
                'verbose_name_plural': 'Contractor Offers',
                'ordering': ['-email_received_at', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='EmailCredential',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('provider', models.CharField(choices=[('gmail', 'Gmail'), ('outlook', 'Outlook')], default='gmail', help_text='Email service provider', max_length=20, verbose_name='Email Provider')),
                ('access_token', models.TextField(blank=True, help_text='OAuth access token', null=True, verbose_name='Access Token')),
                ('refresh_token', models.TextField(blank=True, help_text='OAuth refresh token', null=True, verbose_name='Refresh Token')),
                ('token_expiry', models.DateTimeField(blank=True, help_text='Expiry datetime of the access token', null=True, verbose_name='Token Expiry')),
                ('email_address', models.EmailField(blank=True, help_text='Email address associated with OAuth', max_length=254, null=True, verbose_name='Email Address')),
                ('scopes', models.JSONField(blank=True, help_text='Granted OAuth scopes', null=True, verbose_name='OAuth Scopes')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='email_credential', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'verbose_name': 'Email Credential',
                'verbose_name_plural': 'Email Credentials',
            },
        ),
        migrations.CreateModel(
            name='Message',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('contractor_id', models.IntegerField(help_text='ID of the contractor this conversation is with', verbose_name='Contractor ID')),
                ('sender', models.CharField(choices=[('user', 'User'), ('ai', 'AI Agent'), ('contractor', 'Contractor')], help_text='Who sent this message', max_length=20, verbose_name='Sender')),
                ('message_type', models.CharField(choices=[('user', 'User Message'), ('ai', 'AI Response'), ('ai_action_request', 'AI Action Request'), ('ai_action_executed', 'AI Action Executed')], default='user', help_text='Type of message for rendering purposes', max_length=30, verbose_name='Message Type')),
                ('content', models.TextField(help_text='The text content of the message', verbose_name='Message Content')),
                ('timestamp', models.DateTimeField(auto_now_add=True, help_text='When the message was sent', verbose_name='Timestamp')),
                ('is_read', models.BooleanField(default=False, help_text='Whether the message has been read by the user', verbose_name='Is Read')),
                ('read_at', models.DateTimeField(blank=True, help_text='When the message was marked as read', null=True, verbose_name='Read At')),
                ('contracting_planning', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='messages', to='core.contractingplanning')),
            ],
            options={
                'verbose_name': 'Message',
                'verbose_name_plural': 'Messages',
                'ordering': ['timestamp'],
            },
        ),
        migrations.CreateModel(
            name='MessageAction',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('action_type', models.CharField(choices=[('send_email', 'Send Email'), ('draft_email', 'Draft Email'), ('fetch_email', 'Fetch Email'), ('analyze_offer', 'Analyze Offer'), ('compare_offers', 'Compare Offers')], help_text='Type of action to perform', max_length=20, verbose_name='Action Type')),
                ('action_status', models.CharField(choices=[('pending', 'Pending User Approval'), ('approved', 'Approved'), ('rejected', 'Rejected'), ('executed', 'Executed'), ('failed', 'Failed')], default='pending', help_text='Current status of the action', max_length=20, verbose_name='Action Status')),
                ('action_data', models.JSONField(help_text='Action-specific data (e.g., email subject, body, recipient)', verbose_name='Action Data')),
                ('action_summary', models.TextField(help_text='Human-readable summary for conversation context', verbose_name='Action Summary')),
                ('execution_result', models.JSONField(blank=True, help_text='Results after action execution (e.g., Gmail message_id)', null=True, verbose_name='Execution Result')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('message', models.OneToOneField(help_text='The message this action is associated with', on_delete=django.db.models.deletion.CASCADE, related_name='action', to='core.message')),
            ],
            options={
                'verbose_name': 'Message Action',
                'verbose_name_plural': 'Message Actions',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='MessageAttachment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('file', models.FileField(help_text='Uploaded file', upload_to='message_attachments/%Y/%m/%d/')),
                ('filename', models.CharField(help_text='Original filename', max_length=255, verbose_name='Filename')),
                ('content_type', models.CharField(blank=True, help_text='MIME type of the file', max_length=100, verbose_name='Content Type')),
                ('file_size', models.IntegerField(help_text='Size in bytes', verbose_name='File Size')),
                ('uploaded_at', models.DateTimeField(auto_now_add=True)),
                ('message', models.ForeignKey(help_text='The message this attachment is associated with', on_delete=django.db.models.deletion.CASCADE, related_name='attachments', to='core.message')),
            ],
            options={
                'verbose_name': 'Message Attachment',
                'verbose_name_plural': 'Message Attachments',
                'ordering': ['uploaded_at'],
            },
        ),
        migrations.CreateModel(
            name='OfferAnalysis',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('analysis_type', models.CharField(choices=[('single', 'Single Offer Analysis'), ('comparison', 'Offer Comparison')], help_text='Type of analysis performed', max_length=20, verbose_name='Analysis Type')),
                ('analysis_report', models.TextField(help_text='Markdown formatted analysis report', verbose_name='Analysis Report')),
                ('analysis_data', models.JSONField(blank=True, default=dict, help_text='Structured analysis data for programmatic access', verbose_name='Analysis Data')),
                ('compared_offer_ids', models.JSONField(blank=True, default=list, help_text="List of offer IDs compared (if type='comparison')", verbose_name='Compared Offer IDs')),
                ('documents_used', models.JSONField(blank=True, default=list, help_text='List of document IDs used in RAG pipeline', null=True, verbose_name='Documents Used')),
                ('embeddings_version', models.CharField(blank=True, help_text='Version of embeddings model used', max_length=50, null=True, verbose_name='Embeddings Version')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('offer', models.ForeignKey(help_text='The primary offer being analyzed', on_delete=django.db.models.deletion.CASCADE, related_name='analyses', to='core.contractoroffer')),
            ],
            options={
                'verbose_name': 'Offer Analysis',
                'verbose_name_plural': 'Offer Analyses',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ProcessedEmail',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('gmail_message_id', models.CharField(db_index=True, help_text='Unique Gmail message ID to prevent reprocessing', max_length=255, unique=True, verbose_name='Gmail Message ID')),
                ('contractor_id', models.IntegerField(help_text='ID of the contractor who sent the email', verbose_name='Contractor ID')),
                ('email_subject', models.CharField(blank=True, help_text='Subject line of the email', max_length=500, verbose_name='Email Subject')),
                ('email_received_at', models.DateTimeField(blank=True, help_text='When the email was received in Gmail', null=True, verbose_name='Email Received At')),
                ('processed_at', models.DateTimeField(auto_now_add=True, help_text='When the email was processed by our system', verbose_name='Processed At')),
                ('contracting_planning', models.ForeignKey(help_text='The contracting planning this email belongs to', on_delete=django.db.models.deletion.CASCADE, related_name='processed_emails', to='core.contractingplanning')),
                ('created_message', models.ForeignKey(blank=True, help_text='The system message created for this email', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='source_processed_email', to='core.message')),
                ('created_offer', models.ForeignKey(blank=True, help_text='The offer created from this email (if any)', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='source_processed_email', to='core.contractoroffer')),
            ],
            options={
                'verbose_name': 'Processed Email',
                'verbose_name_plural': 'Processed Emails',
                'ordering': ['-processed_at'],
            },
        ),
        migrations.CreateModel(
            name='Project',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200, verbose_name='Project Name')),
                ('project_type', models.CharField(choices=[('kitchen', 'Kitchen Renovation'), ('bathroom', 'Bathroom Renovation'), ('basement', 'Basement Renovation'), ('roofing', 'Roofing'), ('electrical', 'Electrical'), ('plumbing', 'Plumbing'), ('hvac', 'HVAC'), ('flooring', 'Flooring'), ('windows_doors', 'Windows/Doors'), ('exterior', 'Exterior'), ('general', 'General Renovation')], default='general', max_length=50, verbose_name='Project Type')),
                ('address', models.CharField(max_length=200, verbose_name='Address')),
                ('city', models.CharField(max_length=100, verbose_name='City')),
                ('postal_code', models.CharField(max_length=20, verbose_name='Postal Code')),
                ('state', models.CharField(max_length=100, verbose_name='State')),
                ('budget', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='Budget')),
                ('additional_information', models.TextField(blank=True, help_text='Additional information about the project', null=True, verbose_name='Additional Information')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='projects', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='Offer',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('offer_letter', models.FileField(upload_to='offers/')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('submitted', 'Submitted'), ('accepted', 'Accepted'), ('rejected', 'Rejected')], default='pending', max_length=20)),
                ('amount', models.DecimalField(blank=True, decimal_places=2, max_digits=10, null=True)),
                ('notes', models.TextField(blank=True, null=True)),
                ('submitted_at', models.DateTimeField(blank=True, null=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('contractor', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.contractor')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
                ('project', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='core.project')),
            ],
        ),
        migrations.AddField(
            model_name='contractingplanning',
            name='project',
            field=models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='contracting_planning', to='core.project'),
        ),
        migrations.CreateModel(
            name='RenovationPlan',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('plan_name', models.CharField(default='Untitled Plan', max_length=200)),
                ('plan_data', models.JSONField(blank=True, default=dict)),
                ('input_data', models.JSONField(blank=True, default=dict)),
                ('status', models.CharField(choices=[('draft', 'Draft'), ('generated', 'Generated'), ('approved', 'Approved'), ('archived', 'Archived')], default='generated', max_length=20)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('updated_at', models.DateTimeField(auto_now=True)),
                ('project', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='renovation_plans', to='core.project')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='renovation_plans', to=settings.AUTH_USER_MODEL)),
            ],
            options={
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='SentEmail',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('contractor_email', models.EmailField(help_text='Email address of the contractor', max_length=254, verbose_name='Contractor Email')),
                ('subject', models.CharField(help_text='Subject line of the email', max_length=500, verbose_name='Email Subject')),
                ('body_html', models.TextField(help_text='HTML content of the email body', verbose_name='Email Body HTML')),
                ('sent_at', models.DateTimeField(auto_now_add=True, help_text='Timestamp when the email was sent', verbose_name='Sent At')),
                ('gmail_message_id', models.CharField(blank=True, help_text='Message ID from Gmail API', max_length=255, null=True, verbose_name='Gmail Message ID')),
                ('gmail_thread_id', models.CharField(blank=True, help_text='Thread ID from Gmail API', max_length=255, null=True, verbose_name='Gmail Thread ID')),
                ('status', models.CharField(choices=[('pending', 'Pending'), ('sent', 'Sent'), ('failed', 'Failed')], default='pending', help_text='Status of the email sending', max_length=20, verbose_name='Status')),
                ('error_message', models.TextField(blank=True, help_text='Error message if sending failed', null=True, verbose_name='Error Message')),
                ('contracting_planning', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='sent_emails', to='core.contractingplanning')),
            ],
            options={
                'verbose_name': 'Sent Email',
                'verbose_name_plural': 'Sent Emails',
                'ordering': ['-sent_at'],
            },
        ),
        migrations.AddIndex(
            model_name='contractoroffer',
            index=models.Index(fields=['contracting_planning', 'contractor_id'], name='core_contra_contrac_6a40cd_idx'),
        ),
        migrations.AddIndex(
            model_name='contractoroffer',
            index=models.Index(fields=['gmail_message_id'], name='core_contra_gmail_m_ebdce4_idx'),
        ),
        migrations.AddIndex(
            model_name='contractoroffer',
            index=models.Index(fields=['email_received_at'], name='core_contra_email_r_04689e_idx'),
        ),
        migrations.AddIndex(
            model_name='message',
            index=models.Index(fields=['contracting_planning', 'contractor_id', 'timestamp'], name='core_messag_contrac_48efcd_idx'),
        ),
        migrations.AddIndex(
            model_name='offeranalysis',
            index=models.Index(fields=['offer', 'analysis_type'], name='core_offera_offer_i_1dbcea_idx'),
        ),
        migrations.AddIndex(
            model_name='processedemail',
            index=models.Index(fields=['contracting_planning', 'contractor_id'], name='core_proces_contrac_940533_idx'),
        ),
        migrations.AddIndex(
            model_name='processedemail',
            index=models.Index(fields=['gmail_message_id'], name='core_proces_gmail_m_1249b8_idx'),
        ),
        migrations.AddIndex(
            model_name='processedemail',
            index=models.Index(fields=['processed_at'], name='core_proces_process_86c547_idx'),
        ),
    ]
